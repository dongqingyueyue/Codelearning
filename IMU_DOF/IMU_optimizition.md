# IMU的工程经验

## IMU滤波配置：

IMU型号Invensense 20602，IMU滤波模式分为６种，综合对比测试后选取最优的滤波模式，IMU tuning滤波寄存器的配置主要涉及以下三个寄存器：

(1) 8018fd1a原来读出：0x39， 现在配置0x3a；

(2) 8018fd1b原来读出：0x18， 现在配置0x18 (维持不变)；

(3) 8018fd1d原来读出：0x00， 现在配置0x02；

影响IMU数据变化的主要因素是应力、温度和电气干扰；

１.温度的的骤升，比如芯片的位置附件有相关器件几秒钟工作一次，此时温度骤升，可能会引起数据也发生突变，周围有变化的热源和风扇；

２.周期性的振动或干扰。振动来源于设备上马达，大电感等，或者周边环境带来的振动，地铁导致的地面振动，敲击键盘，人走动，空调机等。

３. MEMS IMU芯片经过贴片，组装的工艺过程，由于受到应力的影响，导致imu芯片中微机械结构受到影响，导致电容板距离变大或变小，从而导致加速度变大或者变小，而对陀螺也会产生一定的影响

４.电气干扰主要来源于电源等,VDD电源输入有噪声，也会导致IMU的输出数据有噪声；

## 优化应力方向：

有些应力可能装机的时候有，过了一段时间没有了，装机时标定的结果就无法使用了，所以最好的方式是保证装机的时候没有应力；

1. IMU芯片尽量避免热源，如果有可能尽量避免主板，采用单独小板的设计；
2. IMU芯片距离螺丝孔周围大于3-5mm的距离；
3. IMU芯片避免螺丝孔对角线上的位置；
4. IMU芯片距离板子的每条边大于3mm；
5. .尽量避免点胶；
6. sensor加一个屏蔽罩或者板子被后加个小钢板；
7. sensor避免处理应力对角线上，避免外壳四周压力的位置，避免螺栓周围的位置；
   优化温度方向：
8. 远离热源
9. 采用产线温度标定，在产线利用温箱设置不同的温度，恒温后获取相应的零偏，该方法标定一台时间长，花费高，带来巨大的经济成本，曾经华为采用该办法最终放弃；
10. 采用热电阻保持恒温模式，大疆的无人机IMU采用该方法，Invensens的某些芯片有该模式，具体的要咨询厂家。
    优化电气干扰
11. 输入的电压VDD一定要稳，无噪声，因此可以添加电容之类的器件；

## 对于bosch芯片的总结

Offset 是指sensor的零偏。Datasheet 里边描述的是在不同的情况下offset 的spec.

OffA, INT 表示sensor 出厂时最初的offset spec, 是component level

OffA, board 表示sensor 在贴到PCB 上的offset spec, 是board level

OffA, MSL 表示sensor 在经历MSL1 precondition 的条件后再焊接到板子上的offset spec

OffA, life 表示sensor 在整个life time 内保证的offset spec, 但是如果机器结构设计不理想，导致PCB 板存在比较大的弯折，sensor offset 会受到比较大的影响，那这种情况就需要特别讨论，而不能直接参考这个spec.

## 装配

MEMS IMU芯片经过贴片，组装的工艺过程，由于受到应力的影响，导致imu芯片中微机械结构受到影响，导致电容板距离变大或变小，从而导致加速度变大或者变小，而对陀螺也会产生一定的影响，主要影响offset的变大或者变小。

数据突变根据之前的经验，有几个原因如下，

1，温度周期的骤升，比如芯片的位置附件有相关器件几秒钟工作一次，此时温度骤升，可能会引起加速度数据也发生突变。

2，周期性的振动或干扰。振动来源于设备上马达，大电感等，或者周边环境带来的振动，地铁导致的地面振动，敲击键盘，人走动，空调机等。电气干扰主要来源于电源等。

根据描述，应该是加速度的任何一个轴与地面垂直的方向，都会有这个跳变，也就是说问题跟着方向走而不是跟着某个轴走，所以初步判断和外部的干扰有关。

导致imu offset过大的情况：

1. imu芯片贴片点胶

  2.imu pcb受到各种应力影响；

减少这种因素的主要举措：

  1.尽量避免点胶；

  2.sensor加一个屏蔽罩；

  3.sensor避免处理应力对角线上，避免外壳四周压力的位置，避免螺栓周围的位置；

## IMU算法方面

imu的数据必须经过标定，至少要将零偏等数据计算出来；

imu的零偏包括固定零偏（受到应力和其他因素的影响）和启动零偏（每次启动不一样，启动之后就固定不变）；

标定一般标定的是固定零偏和部分启动零偏，算法估计的是启动零偏的残差值和温飘。